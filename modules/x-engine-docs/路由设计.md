当前路由的代码实现比较混乱。现作以下规范。



## href 说明

``` js
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                                            href                                             │
├──────────┬──┬─────────────────────┬─────────────────────┬───────────────────────────┬───────┤
│ protocol │  │        auth         │        host         │           path            │ hash  │
│          │  │                     ├──────────────┬──────┼──────────┬────────────────┤       │
│          │  │                     │   hostname   │ port │ pathname │     search     │       │
│          │  │                     │              │      │          ├─┬──────────────┤       │
│          │  │                     │              │      │          │ │    query     │       │
"  https:   //    user   :   pass   @ sub.host.com : 8080   /p/a/t/h  ?  query=string   #hash "
│          │  │          │          │   hostname   │ port │          │                │       │
│          │  │          │          ├──────────────┴──────┤          │                │       │
│ protocol │  │ username │ password │        host         │          │                │       │
├──────────┴──┼──────────┴──────────┼─────────────────────┤          │                │       │
│   origin    │                     │       origin        │ pathname │     search     │ hash  │
├─────────────┴─────────────────────┴─────────────────────┴──────────┴────────────────┴───────┤
│                                            href                                             │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
```



## 路由类型

- (H) H5

- (M) MicroApp  microappId 与本地路径会有一个对应关系

- (N) Native， 将 href 内的 pathname 作为路由的类名信息

- (U) UniApp

- (W) W微信小程序

```
// ZKRouterDTO
{
  type: string (native | h5 | microapp | uni | wx ),  // 类型
  uri:  string (protocol+host | microappId | wx_username | 'XViewController,XActivity'), // 资源名
  path: string, // path=pathname+search  形如 /abc /abc?a=2
}
```

> microappId 可转为 protocol+host
>
> 主要用于本地路径， 形如  file://{沙盒路径}/{微应用文件夹}



## webview 路由设计

如果检测到 H 其实为 M ， 则进入 MicroApp 的 Controller 

M 的 Controller 内的 web 容器 可分为单 webview ，与多 webview

- 为单 webview 时， 

  - goto
    - 直接将当前 webview 路径替换
  - push 时 
    - 将当前页截图并替换 webview 位置
    - webview 路由到新地址，webview 历史+1
    - 增加 controller 层，复用之前 webview
  - back 时
    - 如果历史不为 0， webview 历史 back 一层， 弹出 controller
    - 如果历史为 0，则正常逻辑弹出。

- 为多 webview 时，

  - goto
    - 直接将当前 webview 路径替换
  - push 时 
    - 增加 controller 层，创建新 webview 路由到新地址
  - back 时
    - 正常弹出 controller

  

​               